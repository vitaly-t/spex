<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>spex API</title>
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-spex.html">spex</a></li></ul><h3>Externals</h3><ul><li><a href="external-Error.html">Error</a></li><li><a href="external-Promise.html">Promise</a></li><li><a href="external-TypeError.html">TypeError</a></li></ul><h3>Namespaces</h3><ul><li><a href="errors.html">errors</a></li><li><a href="stream.html">stream</a></li></ul><h3>Classes</h3><ul><li><a href="errors.BatchError.html">BatchError</a></li><li><a href="errors.PageError.html">PageError</a></li><li><a href="errors.SequenceError.html">SequenceError</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-batch.html">Batch Processing</a></li><li><a href="tutorial-client.html">Client-Side Usage</a></li><li><a href="tutorial-mixed.html">Mixed Values</a></li><li><a href="tutorial-sequencing.html">Linked and Detached Sequencing</a></li><li><a href="tutorial-streaming.html">Streaming and Paging</a></li><li><a href="tutorial-throttling.html">Data Throttling & Load Balancing</a></li></ul><h3>Global</h3><ul><li><a href="global.html#batch">batch</a></li><li><a href="global.html#page">page</a></li><li><a href="global.html#sequence">sequence</a></li></ul>
    <div class="home-link">
        <a href="https://github.com/vitaly-t/spex">&lt;&lt; GitHub</a>
    </div>
</nav>

<div id="main">
    <section>

<header>
    

    <h2>Batch Processing</h2>
</header>

<article>
    <hr>
<p>Consider executing a batch/array of promises within a temporary context:</p>
<ul>
<li>queries inside a database transaction</li>
<li>logging a complete result into a file</li>
<li>sending a whole package into a channel</li>
</ul>
<p>Each time you are likely to open a receiving context, execute a batch of independent promises,
and then release the context.</p>
<p>And while rejected promises may or may not be ignored, they often need to be finalized (settled)
in order to avoid execution against a released context.</p>
<p>The standard method <code>promise.all</code> isn't suitable in this case, because it does not guarantee to
settle all the values in the array. And while some libraries offer a separate method to settle
an array of promises, it becomes awkward to combine the logic into one meaningful result, and
certainly not without a loss in performance.</p>
<p>And this is where method <a href="http://vitaly-t.github.io/spex/global.html#batch">batch</a> helps:</p>
<ul>
<li>It settles all of the promises in the array</li>
<li>It resolves in the same way as <code>promise.all</code> when each value in the array resolves</li>
<li>It rejects when any value in the array rejects, providing complete details</li>
<li>It has additional diagnostics and results reporting features</li>
</ul>
<h3>Examples</h3>
<p>Let's start with a positive example, and throw in a few combinations of <a href="http://vitaly-t.github.io/spex/tutorial-mixed.html">mixed values</a>.</p>
<pre class="prettyprint source lang-js"><code>const {batch} = require('spex');

// function that returns a promise;
function getWord() {
    return Promise.resolve('World');
}

// function that returns a value;
function getExcl() {
    return '!';
}

// function that returns another function;
function nested() {
    return getExcl;
}

const values = [
    123,
    'Hello',
    getWord,
    Promise.resolve(nested)
];

batch(values)
    .then(data => {
        console.log('DATA:', data);
    })
    .catch(error => {
        console.log('ERROR:', error);
    });
</code></pre>
<p>This outputs:</p>
<pre class="prettyprint source"><code>DATA: [ 123, 'Hello', 'World', '!' ]
</code></pre>
<p>Now let's make it fail by changing <code>getWord</code> to this:</p>
<pre class="prettyprint source lang-js"><code>function getWord() {
    return Promise.reject('World');
}
</code></pre>
<p>Now the output is:</p>
<pre class="prettyprint source"><code>ERROR: [ { success: true, result: 123 },
  { success: true, result: 'Hello' },
  { success: false, result: 'World' },
  { success: true, result: '!' } ]
</code></pre>
<p>i.e. the entire array is settled, reporting index-bound results.</p>
<p>And if instead of reporting the entire reason we call <code>getErrors()</code>:</p>
<pre class="prettyprint source lang-js"><code>console.log('ERROR:', reason.getErrors());
</code></pre>
<p>then the output will be:</p>
<pre class="prettyprint source"><code>ERROR: [ 'World' ]
</code></pre>
<p>This is just to simplify quick access to the list of errors that occurred.</p>
</article>

</section>

</div>

<br class="clear">

<footer>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"></script>
</body>
</html>