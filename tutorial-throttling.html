<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>spex API</title>
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-spex.html">spex</a></li></ul><h3>Namespaces</h3><ul><li><a href="errors.html">errors</a></li><li><a href="stream.html">stream</a></li></ul><h3>Classes</h3><ul><li><a href="PromiseAdapter.html">PromiseAdapter</a></li><li><a href="errors.BatchError.html">BatchError</a></li><li><a href="errors.PageError.html">PageError</a></li><li><a href="errors.SequenceError.html">SequenceError</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-batch.html">Batch Processing</a></li><li><a href="tutorial-client.html">Client-Side Usage</a></li><li><a href="tutorial-mixed.html">Mixed Values</a></li><li><a href="tutorial-sequencing.html">Linked and Detached Sequencing</a></li><li><a href="tutorial-streaming.html">Streaming and Paging</a></li><li><a href="tutorial-throttling.html">Data Throttling & Load Balancing</a></li></ul><h3>Global</h3><ul><li><a href="global.html#batch">batch</a></li><li><a href="global.html#page">page</a></li><li><a href="global.html#sequence">sequence</a></li></ul>
    <div class="home-link">
        <a href="https://github.com/vitaly-t/spex">&lt;&lt; GitHub</a>
    </div>
</nav>

<div id="main">
    <section>

<header>
    

    <h2>Data Throttling & Load Balancing</h2>
</header>

<article>
    <hr>
<h3>Terminology</h3>
<p><em>Data throttling</em> is processing data in limited chunks, as an intentional bottleneck added for predictable rate of processing /
quantifiable throughput, to control resources consumption and/or a traffic quota.</p>
<p><em>Load balancing</em> is enforcing a time quota on operations that need to take turns with other tasks in the system.
As such, its implementation is usually limited to a single system, while <em>data throttling</em> can be employed by multiple systems independently.</p>
<h3>Solution</h3>
<p>With the help of method <a href="http://vitaly-t.github.io/spex/global.html#page">page</a>, promises can be resolved in chunks, thus throttling the data processing, while method <a href="http://vitaly-t.github.io/spex/global.html#sequence">sequence</a> can do the same
on a one-by-one basis.</p>
<p>Both methods support return of promises from <code>source</code> or <code>destination</code> callbacks, which allows injecting any necessary
delays needed to implement <em>load balancing</em>.</p>
<h3>Examples</h3>
<h5>Balanced Page Source</h5>
<p>The example below uses method <a href="http://vitaly-t.github.io/spex/global.html#page">page</a> to initiate a sequence of 5 pages, and then logs the resolved data into the console.
The <code>source</code> function serves each page with a half-second delay.</p>
<pre class="prettyprint source lang-js"><code>const spex = require('spex')(Promise);

function source(index, data, delay) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            resolve([
                'page-' + index, // simple value;
                Promise.resolve(Date.now()) // promise value;
            ])
        }, 500); // wait 1/2 second before serving the next page;
    });
}

function logger(index, data, delay) {
    console.log('LOG:', data);
}

spex.page(source, {dest: logger, limit: 5})
    .then(data => {
        console.log('FINISHED:', data);
    });
</code></pre>
<p>Output:</p>
<pre class="prettyprint source"><code>LOG: [ 'page-0', 1446050705823 ]
LOG: [ 'page-1', 1446050706327 ]
LOG: [ 'page-2', 1446050706834 ]
LOG: [ 'page-3', 1446050707334 ]
LOG: [ 'page-4', 1446050707839 ]
FINISHED: { pages: 5, total: 10, duration: 2520 }
</code></pre>
<h5>Balanced Sequence Receiver</h5>
<p>In the following example we have a <a href="http://vitaly-t.github.io/spex/global.html#sequence">sequence</a> that returns data while the index is less than 5, and the
destination function that enforces a 1 second delay on processing each data resolved from the source.</p>
<pre class="prettyprint source lang-js"><code>const spex = require('spex')(Promise);

function source(index, data, delay) {
    console.log('SOURCE:', index, data, delay);
    if (index &lt; 5) {
        return Promise.resolve(index);
    }
}

function dest(index, data, delay) {
    console.log('DEST:', index, data, delay);
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            resolve();
        }, 1000);
    });
}

spex.sequence(source, {dest: dest})
    .then(data => {
        console.log('DATA:', data);
    });
</code></pre>
<p>Output:</p>
<pre class="prettyprint source"><code>SOURCE: 0 undefined undefined
DEST: 0 0 undefined
SOURCE: 1 0 1011
DEST: 1 1 1001
SOURCE: 2 1 1001
DEST: 2 2 1001
SOURCE: 3 2 1000
DEST: 3 3 1000
SOURCE: 4 3 1001
DEST: 4 4 1001
SOURCE: 5 4 1000
DATA: { total: 5, duration: 5013 }
</code></pre>
</article>

</section>

</div>

<br class="clear">

<footer>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"></script>
</body>
</html>